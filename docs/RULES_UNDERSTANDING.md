# üéØ –ü–æ–Ω–∏–º–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –ø—Ä–∞–≤–∏–ª Hermes

## üìù –ê–Ω–∞–ª–∏–∑ –≤–∞—à–µ–π –ø—Ä–æ–±–ª–µ–º—ã

–ò–∑ –≤–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö —è –≤–∏–∂—É:

### ‚úÖ **–†–∞–±–æ—Ç–∞—é—â–µ–µ –ø—Ä–∞–≤–∏–ª–æ** "Test Real Data"

```json
{
  "name": "Test Real Data",
  "productName": "Erexol",
  "sendWindowStart": "09:00",
  "sendWindowEnd": "18:00",
  "country": "PT",
  "status": "Reject",
  "totalSent": 10,
  "totalSuccess": 10,
  "successRate": "100.0%"
}
```

### ‚ùå **–ü—Ä–æ–±–ª–µ–º–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ** "Fixed Test Rule"

```json
{
  "name": "Fixed Test Rule",
  "productName": "Carthisin",
  "sendWindowStart": "21:00",
  "sendWindowEnd": "18:00", // ‚ùå –ü–†–û–ë–õ–ï–ú–ê: 21:00 ‚Üí 18:00 (–∏–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–∫–Ω–æ)
  "totalSent": 0,
  "totalSuccess": 0
}
```

## üîç –ü–æ—á–µ–º—É –≤—Ç–æ—Ä–æ–µ –ø—Ä–∞–≤–∏–ª–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ì–ª–∞–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞**: `sendWindowStart: "21:00"` –±–æ–ª—å—à–µ —á–µ–º `sendWindowEnd: "18:00"`

```typescript
// –í –∫–æ–¥–µ LeadSchedulingService
if (windowEnd <= windowStart && !rule.isInfinite) {
  this.logger.warn(`rule ${rule.id}: empty/inverted window`);
  return; // ‚ùå –í—ã—Ö–æ–¥ –±–µ–∑ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ª–∏–¥–æ–≤
}
```

## ‚úÖ –ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤—Ç–æ—Ä–æ–µ –ø—Ä–∞–≤–∏–ª–æ

```json
{
  "name": "Fixed Test Rule",
  "productName": "Carthisin",
  "sendWindowStart": "08:00", // ‚úÖ —Ä–∞–Ω—å—à–µ —á–µ–º end
  "sendWindowEnd": "20:00", // ‚úÖ –ø–æ–∑–∂–µ —á–µ–º start
  "country": "PT",
  "status": "Sale", // –∏–ª–∏ –¥—Ä—É–≥–æ–π –¥–æ—Å—Ç—É–ø–Ω—ã–π —Å—Ç–∞—Ç—É—Å
  "dailyCapLimit": 5,
  "minInterval": 1,
  "maxInterval": 5
}
```

## üïê –ö–æ–≥–¥–∞ –æ–∂–∏–¥–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ (1-2 –º–∏–Ω—É—Ç—ã)**

1. –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–∞–≤–∏–ª–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è `setImmediate()`
2. –°–∏—Å—Ç–µ–º–∞ –ø–æ–ª—É—á–∞–µ—Ç –ª–∏–¥—ã –∏–∑ –≤–Ω–µ—à–Ω–µ–≥–æ API
3. –ü–ª–∞–Ω–∏—Ä—É–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–≥–ª–∞—Å–Ω–æ `minInterval`/`maxInterval`

### **–í –∞–Ω–∞–ª–∏—Ç–∏–∫–µ (30 —Å–µ–∫—É–Ω–¥)**

- –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
- API: `GET /api/internal/rules/analytics/overview`

### **–í—Ä–µ–º–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞**

```typescript
// –ü—Ä–∏–º–µ—Ä —Å minInterval=1, maxInterval=5
const randomMinutes = Math.random() * (5 - 1) + 1; // 1-5 –º–∏–Ω—É—Ç
const delay = randomMinutes * 60 * 1000; // –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö

setTimeout(() => {
  sendLead(lead); // –û—Ç–ø—Ä–∞–≤–∫–∞ –ª–∏–¥–∞
}, delay);
```

## üìã –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞

### **–ü—Ä–∞–≤–∏–ª–æ #1: –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç (—Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞ 2-3 –º–∏–Ω—É—Ç—ã)**

```json
{
  "name": "Quick Test Portugal",
  "productId": "test-001",
  "productName": "Erexol",
  "periodMinutes": 5,
  "minInterval": 1,
  "maxInterval": 2,
  "dailyCapLimit": 3,
  "sendWindowStart": "08:00",
  "sendWindowEnd": "22:00",
  "isActive": true,
  "isInfinite": false,
  "country": "PT",
  "status": "Reject"
}
```

### **–ü—Ä–∞–≤–∏–ª–æ #2: –ë–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å)**

```json
{
  "name": "Unlimited Portugal Leads",
  "productId": "unlimited-001",
  "productName": "Erexol",
  "periodMinutes": 3,
  "minInterval": 1,
  "maxInterval": 3,
  "dailyCapLimit": 100,
  "isActive": true,
  "isInfinite": true,
  "country": "PT",
  "vertical": "–ü–æ—Ç–µ–Ω—Ü–∏—è"
}
```

### **–ü—Ä–∞–≤–∏–ª–æ #3: –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ–µ (–º–µ–¥–ª–µ–Ω–Ω–æ –Ω–æ –Ω–∞–¥–µ–∂–Ω–æ)**

```json
{
  "name": "Conservative Health Rule",
  "productId": "health-001",
  "productName": "HealthProduct",
  "periodMinutes": 15,
  "minInterval": 5,
  "maxInterval": 10,
  "dailyCapLimit": 10,
  "sendWindowStart": "09:00",
  "sendWindowEnd": "18:00",
  "isActive": true,
  "isInfinite": false,
  "country": "DE",
  "vertical": "–ó–¥–æ—Ä–æ–≤—å–µ",
  "status": "Sale"
}
```

## üîç –ö–∞–∫ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### **1. –í —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ (–ª–æ–≥–∏)**

```bash
# –°–º–æ—Ç—Ä–∏–º –ª–æ–≥–∏ backend
tail -f backend/logs/app.log | grep "rule.*lead.*sent"

# –£—Å–ø–µ—à–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:
# [LeadSchedulingService] rule abc123: lead xyz789 sent (HTTP 200)
```

### **2. –í –±—Ä–∞—É–∑–µ—Ä–µ (–∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥)**

- –û—Ç–∫—Ä–æ–π—Ç–µ `/dashboard` ‚Üí –≤–∫–ª–∞–¥–∫–∞ "–ê–Ω–∞–ª–∏—Ç–∏–∫–∞"
- –ò–ª–∏ `/monitoring` –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

### **3. API –∑–∞–ø—Ä–æ—Å—ã**

```bash
# –û–±—â–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
curl http://localhost:3004/api/rules/analytics/overview

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ
curl http://localhost:3004/api/rules/{ruleId}/analytics

# –¢–µ—Å—Ç –ø—Ä–∞–≤–∏–ª–∞
curl -X POST http://localhost:3004/api/rules/{ruleId}/test
```

## üéØ –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã —É—Å–ø–µ—Ö–∞

### **1. –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –æ–∫–Ω–æ**

```javascript
‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ: "09:00" ‚Üí "18:00"
‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ: "21:00" ‚Üí "18:00"
```

### **2. –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ª–∏–¥–æ–≤**

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –µ—Å—Ç—å –ª–∏–¥—ã —Å –∑–∞–¥–∞–Ω–Ω—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
- `country`, `vertical`, `status` –¥–æ–ª–∂–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–º –¥–∞–Ω–Ω—ã–º
- –°–∏—Å—Ç–µ–º–∞ –¥–µ–ª–∞–µ—Ç fallback –∫ `productName` –µ—Å–ª–∏ —Ñ–∏–ª—å—Ç—Ä—ã –ø—É—Å—Ç—ã–µ

### **3. –†–∞–∑—É–º–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã**

```javascript
‚úÖ –î–ª—è —Ç–µ—Å—Ç–æ–≤: minInterval: 1, maxInterval: 3 (1-3 –º–∏–Ω—É—Ç—ã)
‚úÖ –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞: minInterval: 5, maxInterval: 15 (5-15 –º–∏–Ω—É—Ç)
‚ùå –°–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä–æ: minInterval: 0, maxInterval: 1 (–º–æ–∂–µ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∏—Ç—å API)
```

### **4. –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø—Ä–∞–≤–∏–ª–∞**

```json
{
  "isActive": true // ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å true
}
```

## üö® –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏

### **–û—à–∏–±–∫–∞ #1: –ò–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –æ–∫–Ω–æ**

```json
‚ùå "sendWindowStart": "20:00", "sendWindowEnd": "08:00"
‚úÖ "sendWindowStart": "08:00", "sendWindowEnd": "20:00"
```

### **–û—à–∏–±–∫–∞ #2: –ù–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –ª–∏–¥–æ–≤**

```json
‚ùå –û—á–µ–Ω—å —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã:
{
  "country": "XX",      // –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Å—Ç—Ä–∞–Ω–∞
  "vertical": "Test",   // –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å
  "status": "Unknown"   // –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Å—Ç–∞—Ç—É—Å
}

‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–∑–≤–µ—Å—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
{
  "country": "PT",         // –ü–æ—Ä—Ç—É–≥–∞–ª–∏—è
  "vertical": "–ü–æ—Ç–µ–Ω—Ü–∏—è",  // —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å
  "status": "Reject"       // —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Å—Ç–∞—Ç—É—Å
}
```

### **–û—à–∏–±–∫–∞ #3: –°–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–∏–π dailyCapLimit**

```json
‚ùå "dailyCapLimit": 1  // —Ç–æ–ª—å–∫–æ –ª–∏–¥—ã —Å redirects <= 1
‚úÖ "dailyCapLimit": 10 // –∏–ª–∏ –≤–æ–æ–±—â–µ –Ω–µ —É–∫–∞–∑—ã–≤–∞—Ç—å –¥–ª—è —Ç–µ—Å—Ç–æ–≤
```

## üìä –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### **–£—Å–ø–µ—à–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞**

```json
{
  "rule": {
    "name": "Test Rule",
    "isActive": true
  },
  "stats": {
    "totalSent": 5,
    "totalSuccess": 5,
    "totalErrors": 0,
    "successRate": "100.0%"
  },
  "recentSendings": [
    {
      "leadName": "John Doe",
      "phone": "+1234567890",
      "status": "success",
      "sentAt": "2024-01-15T10:30:00Z"
    }
  ]
}
```

### **–ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–∞–≤–∏–ª–æ–º**

```json
{
  "stats": {
    "totalSent": 0, // ‚ùå –ù–µ—Ç –æ—Ç–ø—Ä–∞–≤–æ–∫
    "totalSuccess": 0,
    "totalErrors": 0,
    "successRate": "0%"
  },
  "recentSendings": [] // ‚ùå –ü—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤
}
```

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –µ—Å–ª–∏ –Ω–µ—Ç –æ—Ç–ø—Ä–∞–≤–æ–∫:**

1. `sendWindowStart` < `sendWindowEnd`
2. `isActive: true`
3. –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –æ–∫–Ω–æ –æ—Ç–ø—Ä–∞–≤–∫–∏
4. –ï—Å—Ç—å –ª–∏–¥—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞–º
5. –í–Ω–µ—à–Ω–∏–π API –¥–æ—Å—Ç—É–ø–µ–Ω

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–í–∞—à–∞ —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ!** –ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ —Ç–æ–ª—å–∫–æ –≤ –æ–¥–Ω–æ–º –ø—Ä–∞–≤–∏–ª–µ —Å –∏–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –≤—Ä–µ–º–µ–Ω–Ω—ã–º –æ–∫–Ω–æ–º.

**–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω:**

- ‚úÖ –†–∞–∑–º–µ—Ä –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ —É–º–µ–Ω—å—à–µ–Ω —Å 1000+ –¥–æ 145 —Å—Ç—Ä–æ–∫ (85% —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ)
- ‚úÖ –°–æ–∑–¥–∞–Ω–æ 5 —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –ø–æ–ª–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö: `productId` –≤–º–µ—Å—Ç–æ `offerId`, `dailyCapLimit` –≤–º–µ—Å—Ç–æ `cap` + `dailyLimit`

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**

1. –ò—Å–ø—Ä–∞–≤—å—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –æ–∫–Ω–æ –≤–æ –≤—Ç–æ—Ä–æ–º –ø—Ä–∞–≤–∏–ª–µ
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø—Ä–∞–≤–∏–ª –∏–∑ –ø—Ä–∏–º–µ—Ä–æ–≤ –≤—ã—à–µ
3. –û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ —á–µ—Ä–µ–∑ 1-2 –º–∏–Ω—É—Ç—ã
4. –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–π—Ç–µ –Ω–∞ –±–æ–ª—å—à–∏–µ –æ–±—ä–µ–º—ã
